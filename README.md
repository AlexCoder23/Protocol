# Protocol_4.1 - Документация по протоколу общения через WebSocket

## Общее описание

Этот протокол предоставляет систему для общения между ботами и клиентами через WebSocket. Основные возможности:
- Боты могут регистрироваться под уникальными именами
- Клиенты могут подключаться к ботам
- Обе стороны могут обмениваться сообщениями
- Поддержка поиска доступных ботов

## Установка соединения

1. Установите соединение WebSocket с сервером по адресу `wss://alexcoder23.ru/wnet/ws`

## Авторизация через cookies

Для работы с WebSocket-протоколом на стороне бота требуется предварительная авторизация через cookies. Авторизация проводится путем добавления cookies с именем `auth` в формате:

```
auth="type=password&auth=$авторизационные данные$"
```

Где:
- `type=password` - указывает тип авторизации (в данном случае по паролю)
- `auth=$авторизационные данные$` - ваши авторизационные данные на нашем сайте, которые можно получить в профиле на сайте и в боте

Авторизация для клиентов не обязательна, однако приватные боты, которые отслеживают авторизацию клиента при подключении, могут вам не отвечать.

## Команды для ботов

### `add@имя`
Регистрирует бота под указанным именем. Имя должно:
- Содержать только буквы (a-zA-Z)
- Быть не длиннее 18 символов
  
Если бот с указаным именем существует, то ему посылается запрос о работоспособности соединения вида `isalive`, а новому боту присылается `error@Such bot connected. Sending ping to confirm that bot is alive.`, если старый бот не ответит на запрос командой `alive` в течении ≈ 5 секунд, то соединение с ним разрывается и имя присваевается новому боту.

**Ответы:**
- `info@You added as bot` - успешная регистрация
- `error@...` - ошибка с описанием

### `alive`
Нужна для ответа на запрос о работоспособности соединения при попытке подключения бота с зарегистрированным в сети именем(возможно старый бот с этим именем отключился некорректно и соединение с закреплённым за ним именем зависло)

**Ответы:**
- `error@...` - ошибка с описанием

### `scsend@sid_клиента@сообщение`
Отправляет сообщение конкретному клиенту, подключенному к боту

**Собщение клиенту:**
- `mess@$bot_id$@$message$` -, где \$bot\_id\$ - id бота, а \$message\$ само сообщение

## Команды для клиентов

### `search@шаблон`
Ищет ботов, имена которых начинаются с указанного шаблона

**Ответ:** `list@$запрошенный_шаблон$@$список$@$имен$@$через$@$собачку$`

### `connect@id_бота`
Подключается к указанному боту

**Ответы клиенту:**
- `connectedto@$bot_id$` - успешное подключение
- `error@...` - ошибка с описанием

**Собщение боту:**
- `connection@$sid$@$auth_data$` -, где sid - сид клиента, а auth\_data авторизационные данные клиента(если их нет - None)

### `cssend@id_бота@сообщение`
Отправляет сообщение боту, к которому подключен клиент

**Собщение боту:**
- `mess@$sid$@$message$` -, где sid - сид клиента, а message - само сообщение

### `disconnect@id_бота`
Отключается от указанного бота

**Ответы клиенту:**
- `disconnectedfrom@$bot_id$` - успешное подключение, где bot_id - id бота, от которого произошло отключение

**Собщение боту:**
- `disconnected@$sid$` -, где sid - сид клиента
